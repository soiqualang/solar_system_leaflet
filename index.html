<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar System Simulator</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000000; font-family: 'Inter', sans-serif; color: white; }
        canvas { display: block; }
        .label {
            color: #fff;
            font-family: sans-serif;
            padding: 2px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 4px;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="relative">
    <canvas id="three-canvas"></canvas>
    <div class="fixed bottom-0 left-0 right-0 p-4 text-xs text-gray-400 text-center bg-black bg-opacity-50">
        Kéo chuột để xoay và cuộn để thu phóng.
    </div>
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/"
        }
    }
    </script>
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // --- Basic Setup ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 5000);
        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('three-canvas'), antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // --- Camera and Controls ---
        camera.position.set(0, 150, 400);
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;

        // --- Lighting ---
        const ambientLight = new THREE.AmbientLight(0x404040, 0.5); // Soft ambient light
        scene.add(ambientLight);

        // --- Sun ---
        const sunGeometry = new THREE.SphereGeometry(20, 32, 32);
        const sunMaterial = new THREE.MeshBasicMaterial({ color: 0xffdd00 });
        const sun = new THREE.Mesh(sunGeometry, sunMaterial);
        scene.add(sun);

        const pointLight = new THREE.PointLight(0xffffff, 2, 3000);
        sun.add(pointLight);

        // --- Data for Solar System ---
        // Note: Sizes and distances are not to scale, but are relative for visualization.
        const solarSystemData = [
            { name: 'Mercury', radius: 2, distance: 50, color: 0x8c8c8c, speed: 0.004 },
            { name: 'Venus', radius: 4, distance: 80, color: 0xa57c1b, speed: 0.002 },
            { name: 'Earth', radius: 5, distance: 120, color: 0x0077be, speed: 0.001, moons: [{ name: 'Moon', radius: 1, distance: 10, color: 0xaaaaaa, speed: 0.01 }] },
            { name: 'Mars', radius: 3, distance: 160, color: 0xc1440e, speed: 0.0008, moons: [{ name: 'Phobos', radius: 0.5, distance: 6, color: 0x8c8c8c, speed: 0.02 }, { name: 'Deimos', radius: 0.4, distance: 8, color: 0xaaaaaa, speed: 0.015 }] },
            { name: 'Jupiter', radius: 12, distance: 240, color: 0xd8ca9d, speed: 0.0004, moons: [{ name: 'Io', radius: 1, distance: 18, color: 0xf1d04f, speed: 0.015 }, { name: 'Europa', radius: 0.9, distance: 22, color: 0x9c8865, speed: 0.012 }, { name: 'Ganymede', radius: 1.5, distance: 28, color: 0x7b6f61, speed: 0.01 }, { name: 'Callisto', radius: 1.4, distance: 35, color: 0x5b5148, speed: 0.008 }] },
            { name: 'Saturn', radius: 10, distance: 320, color: 0xe3e0b8, speed: 0.0003, rings: { inner: 12, outer: 22, color: 0xaaaaaa }, moons: [{ name: 'Titan', radius: 1.5, distance: 25, color: 0xf4a460, speed: 0.009 }] },
            { name: 'Uranus', radius: 7, distance: 400, color: 0x7fecfd, speed: 0.0002, rings: { inner: 9, outer: 13, color: 0xadd8e6 } },
            { name: 'Neptune', radius: 7, distance: 480, color: 0x3f54ba, speed: 0.0001 }
        ];

        const planets = [];

        // --- Creation Functions ---
        function createCelestialBody(data) {
            const geometry = new THREE.SphereGeometry(data.radius, 16, 16);
            const material = new THREE.MeshStandardMaterial({ color: data.color });
            const mesh = new THREE.Mesh(geometry, material);
            
            const pivot = new THREE.Object3D();
            pivot.add(mesh);
            mesh.position.x = data.distance;

            // Create orbit path
            const orbitGeometry = new THREE.RingGeometry(data.distance - 0.1, data.distance + 0.1, 128);
            const orbitMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff, side: THREE.DoubleSide, transparent: true, opacity: 0.1 });
            const orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
            orbit.rotation.x = Math.PI / 2;
            scene.add(orbit); // Add orbit directly to the scene

            // Add rings if any
            if (data.rings) {
                const ringGeo = new THREE.RingGeometry(data.rings.inner, data.rings.outer, 64);
                const ringMat = new THREE.MeshBasicMaterial({ color: data.rings.color, side: THREE.DoubleSide, transparent: true, opacity: 0.6 });
                const ringMesh = new THREE.Mesh(ringGeo, ringMat);
                ringMesh.rotation.x = Math.PI * 0.4;
                mesh.add(ringMesh);
            }

            // Add moons if any
            const moonObjects = [];
            if (data.moons) {
                data.moons.forEach(moonData => {
                    const moonObj = createCelestialBody(moonData);
                    mesh.add(moonObj.pivot); // Moons orbit the planet
                    moonObjects.push(moonObj);
                });
            }

            return { pivot, mesh, moons: moonObjects, speed: data.speed, selfSpeed: 0.01 };
        }

        function createBelt(innerRadius, outerRadius, particleCount, color) {
            const beltGroup = new THREE.Group();
            const positions = [];
            const sizes = [];

            for (let i = 0; i < particleCount; i++) {
                const angle = Math.random() * Math.PI * 2;
                const radius = innerRadius + Math.random() * (outerRadius - innerRadius);
                const y = (Math.random() - 0.5) * 5; // Spread them out vertically
                
                const x = Math.cos(angle) * radius;
                const z = Math.sin(angle) * radius;
                
                const size = Math.random() * 0.5 + 0.1;
                const asteroidGeo = new THREE.IcosahedronGeometry(size, 0);
                const asteroidMat = new THREE.MeshStandardMaterial({ color: color, flatShading: true });
                const asteroid = new THREE.Mesh(asteroidGeo, asteroidMat);
                asteroid.position.set(x, y, z);
                beltGroup.add(asteroid);
            }
            return beltGroup;
        }

        // --- Build The Solar System ---
        solarSystemData.forEach(data => {
            const planetObj = createCelestialBody(data);
            scene.add(planetObj.pivot);
            planets.push(planetObj);
        });

        // Asteroid Belt (between Mars and Jupiter)
        const asteroidBelt = createBelt(180, 220, 1500, 0x8B4513);
        scene.add(asteroidBelt);

        // Kuiper Belt (beyond Neptune)
        const kuiperBelt = createBelt(500, 700, 2000, 0xa0a0a0);
        scene.add(kuiperBelt);


        // --- Animation Loop ---
        function animate() {
            requestAnimationFrame(animate);

            // Animate planets and their moons
            planets.forEach(p => {
                p.pivot.rotation.y += p.speed;
                p.mesh.rotation.y += p.selfSpeed;

                p.moons.forEach(m => {
                    m.pivot.rotation.y += m.speed;
                    m.mesh.rotation.y += m.selfSpeed;
                });
            });
            
            // Animate belts
            asteroidBelt.rotation.y += 0.0001;
            kuiperBelt.rotation.y += 0.00005;

            controls.update();
            renderer.render(scene, camera);
        }

        animate();

        // --- Resize Handling ---
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>
